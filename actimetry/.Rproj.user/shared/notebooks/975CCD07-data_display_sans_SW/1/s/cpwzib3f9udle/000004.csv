"0","time_threshold <- 1"
"0","immobility_length_threshold <- 1"
"0",""
"0","## script for immobility but with adding a column to save the time of every acceleration in order to display"
"0","row_threshold <- time_threshold * resampling_frequency"
"0","immobility_length_threshold <- immobility_length_threshold * resampling_frequency"
"0",""
"0","df <- resampled_accelerations"
"0","df <- cbind(abscissa, resampled_accelerations)"
"0","df$immobility <- 0"
"0","df[abs(df$overall_left_acc) + abs(df$overall_right_acc) < immobility_threshold, ""immobility""] <- 1"
"0",""
"0","## We consider that there is immobility only if there is enough successive immobility"
"0","immo_successive <- diff(which(df$immobility == 1))"
"0","counter <- which(df$immobility == 1)[1]"
"0","indexes_to_change <- c()"
"0","i <- 1"
"0","while (i < length(immo_successive)){"
"0","  if (immo_successive[i] == 1){"
"0","    l <- i"
"0","    nb_immo <- 0"
"0","    index <- c()"
"0","    while((l< length(immo_successive)) && (immo_successive[l] == 1)){"
"0","      index <- c(index, counter + nb_immo)"
"0","      nb_immo <- nb_immo + 1"
"0","      l <- l + 1"
"0","    }"
"0","    index <- c(index, counter + nb_immo)"
"0","    if (nb_immo < immobility_length_threshold){"
"0","      indexes_to_change <- c(indexes_to_change, index)"
"0","    }"
"0","    counter <- counter + nb_immo + immo_successive[l]"
"0","    i <- l + 1"
"0","  } else {"
"0","    counter <- counter + immo_successive[i]"
"0","    i <- i + 1"
"0","  }"
"0","}"
"0",""
"0","for (ind in indexes_to_change){"
"0","  df$immobility[ind] <- 0"
"0","}"
"0",""
"0","#we determine the beginning of movements"
"0","if (df$immobility[1] == 0){"
"0","  df$start_mov <- c(-1, diff(df$immobility))"
"0","} else if (df$immobility[1] == 1){"
"0","  df$start_mov <- c(0, diff(df$immobility))"
"0","}"
"0",""
"0","filtered_data <- df[df$immobility == 0, ]"
"0",""
"0"," start_short_move <- c()"
"0"," gaps <- diff(which(filtered_data$start_mov == - 1))#return the difference between"
"0",""
"0","if (gaps[1] < row_threshold){"
"0","  start_short_move <- c(start_short_move, 1) #List of the index of beginning of short movements"
"0","}"
"0","ind_tot <- gaps[1] #We count the index where we are"
"0",""
"0","for (k in 2:length(gaps)){"
"0","  if (gaps[k] < row_threshold){"
"0","    start_short_move <- c(start_short_move, ind_tot + 1) #We use the total index from the range before + 1, because it corresponds to the beginning of this short movement"
"0","   }"
"0","  ind_tot <- ind_tot + gaps[k]#the index in the list"
"0","}"
"0",""
"0","if(tail(start_short_move, 1) == nrow(filtered_data)){ #we check that their is no a problem with the value on the border"
"0","  start_short_move <- start_short_move[-length(start_short_move)]"
"0","}"
"0",""
"0","index_to_remove <- c()"
"0","for (i in start_short_move){"
"0","  k <- i + 1"
"0","  while(filtered_data$start_mov[k] != - 1){"
"0","    index_to_remove <- c(index_to_remove, k)"
"0","    k <- k + 1"
"0","  }"
"0","}"
"0","filtered_data <- filtered_data[-index_to_remove, ]"
"0",""
"0","########### Display of the motion data (the immobility data have been removed)"
"0","overall_left_acc <- filtered_data$overall_left_acc"
"0","overall_right_acc <- filtered_data$overall_right_acc"
"0",""
"0","ordinate_filtered <- abs(filtered_data$overall_left_acc) + abs(filtered_data$overall_right_acc)"
"0","abscissa_filtered <- filtered_data$abscissa"
"0","df_filtered <- data.frame(abscissa_filtered, ordinate_filtered)"
"0","colnames(df_filtered) <-c(""Time"", ""Acceleration"")"
"0","ymax_filtered <- max(ordinate_filtered)"
"0",""
"0","## Display"
"0","ggplot(df_filtered, aes(Time, Acceleration)) + geom_point(shape = 20, size = 0.2) +"
"0","  xlab(""Time (s)"") + ylab(""Sum of absolute components of wrist acceleration (g)"") + "
"0","  ylim(0, ymax_filtered) "
